import{q as k,b as T,j as t,r as w,a as f}from"./app-D4LeRcz-.js";import{o as F}from"./ConfirmModal-C-Ih1xUs.js";import{c as p,D as N,a as P}from"./TaskDrawer.module-DQtVVtaZ.js";import{R as A}from"./RichTextEditor-y390pysp.js";import{u as E}from"./useTaskDrawerStore-0hUAEfq9.js";import{u as M}from"./useForm-B7fipGN7.js";import{h as R}from"./user-IyQLa11_.js";import Y from"./LabelsDropdown-DESZTGUR.js";import{P as o}from"./enums-C8PG_d5N.js";import{D as I}from"./Drawer-BtIeIGkv.js";import{T as O}from"./Text-CzrlvvXy.js";import{T as q}from"./TextInput-DRGNA9wl.js";import{M as H}from"./MultiSelect-qYHmzHib.js";import{F as L}from"./Flex-CdQtan9q.js";import{S as c}from"./Select-BQGepa1f.js";import{N as h}from"./NumberInput-EWnAPIl4.js";import{C as x}from"./Checkbox-CaaVdcyM.js";import"./file-D4aCAaTQ.js";import"./upper-first-sQkIoMXG.js";import"./use-resolved-styles-api-ClQ3aNa8.js";import"./use-disclosure-BUX4v9Ej.js";import"./IconCircleX-4GUC5knc.js";import"./createReactComponent-DvqdhCGr.js";import"./Image-Ck8bvJk_.js";import"./Center-CCRWs1KI.js";import"./IconX-DmULki5g.js";import"./SimpleGrid-ZtMkFqSk.js";import"./get-sorted-breakpoints-BPN_P9jc.js";import"./get-base-value-JqT_q0U7.js";import"./pick-calendar-levels-props-B7T8wbbP.js";import"./use-uncontrolled-D4udaf1u.js";import"./AccordionChevron-EMLFa_4k.js";import"./clamp-DTmYCdls.js";import"./InputBase-UfetLwmU.js";import"./Input-DgDk-0wJ.js";import"./create-optional-context-DIHD1p9X.js";import"./Popover-DklDwA2e.js";import"./DirectionProvider-BfCW8nl5.js";import"./use-floating-auto-update-CkIo9cus.js";import"./use-computed-color-scheme-DIep1U8t.js";import"./Tooltip-D6COxl5A.js";import"./get-style-object-DUJZA7T_.js";import"./ColorSwatch-CG_Yzh_s.js";import"./ColorPicker-CYgcYNpL.js";import"./ActionIcon-wK1_jKv1.js";import"./route-D3oki3go.js";import"./_baseClone-BatMgSYk.js";import"./index-DSL0mJnk.js";import"./index-DsCOHdEJ.js";import"./Label-B4Jc12RG.js";import"./Combobox-DnGWXCU-.js";import"./PillsInput-DfF2hQDi.js";import"./Pill-DFbPvVIq.js";import"./CheckIcon-D7wk-t0p.js";import"./OptionsDropdown-CxPr4e2C.js";import"./ScrollArea-BtKPsKY9.js";import"./get-auto-contrast-value-Da6zqqWm.js";function Je(){const{create:i,closeCreateTask:d}=E(),{usersWithAccessToProject:u,taskGroups:_,labels:j,project:s,currency:l,auth:{user:g}}=k().props,n={group_id:i.group_id?i.group_id.toString():"",assigned_to_user_id:"",name:"",description:"",pricing_type:(s==null?void 0:s.default_pricing_type)||o.HOURLY,estimation:"",fixed_price:"",due_on:"",hidden_from_clients:!1,billable:!0,subscribed_users:[g.id.toString()],labels:[],attachments:[]},[r,S,a]=M("post",route("projects.tasks.store",[route().params.project]),{...n});T.useEffect(()=>{a({...n})},[i.opened]);const m=(e=!1)=>{e||JSON.stringify(r.data)===JSON.stringify(n)&&!r.processing?d():F({type:"danger",title:"Discard changes?",content:"All unsaved changes will be lost.",confirmLabel:"Discard",confirmProps:{color:"red"},onConfirm:()=>d()})},v=e=>{const b=[...r.data.attachments];b.splice(e,1),a("attachments",b)},C=[{value:o.HOURLY,label:"Hourly"},{value:o.FIXED,label:"Fixed"}],y=r.data.pricing_type===o.FIXED,D=(l==null?void 0:l.symbol)||"";return t.jsx(I,{opened:i.opened,onClose:m,title:t.jsx(O,{fz:w(28),fw:600,ml:25,my:"sm",children:"Add new task"}),position:"right",size:1e3,overlayProps:{backgroundOpacity:.55,blur:3},transitionProps:{transition:"slide-left",duration:400,timingFunction:"ease"},children:t.jsxs("form",{onSubmit:e=>S(e,{onSuccess:()=>m(!0),forceFormData:!0}),className:p.inner,children:[t.jsxs("div",{className:p.content,children:[t.jsx(q,{label:"Name",placeholder:"Task name",required:!0,"data-autofocus":!0,value:r.data.name,onChange:e=>a("name",e.target.value),error:r.errors.name}),t.jsx(A,{mt:"xl",placeholder:"Task description",height:260,onChange:e=>a("description",e)}),t.jsx(N,{mt:"xl",selected:r.data.attachments,onChange:e=>a("attachments",e),remove:e=>v(e)}),t.jsx(H,{label:"Subscribers",placeholder:"Select subscribers",searchable:!0,mt:"md",value:r.data.subscribed_users,onChange:e=>a("subscribed_users",e),data:u.map(e=>({value:e.id.toString(),label:e.name})),error:r.errors.subscribed_users}),t.jsxs(L,{justify:"space-between",mt:"xl",children:[t.jsx(f,{variant:"transparent",w:100,disabled:r.processing,onClick:m,children:"Cancel"}),t.jsx(f,{type:"submit",w:120,loading:r.processing,children:"Add task"})]})]}),t.jsxs("div",{className:p.sidebar,children:[t.jsx(c,{label:"Task group",placeholder:"Select task group",required:!0,value:r.data.group_id,onChange:e=>a("group_id",e),data:_.map(e=>({value:e.id.toString(),label:e.name})),error:r.errors.group_id}),t.jsx(c,{label:"Assignee",placeholder:"Select assignee",searchable:!0,mt:"md",value:r.data.assigned_to_user_id,onChange:e=>a("assigned_to_user_id",e),data:u.map(e=>({value:e.id.toString(),label:e.name})),error:r.errors.assigned_to_user_id}),t.jsx(P,{clearable:!0,valueFormat:"DD MMM YYYY",minDate:new Date,mt:"md",label:"Due date",placeholder:"Pick task due date",value:r.data.due_on,onChange:e=>a("due_on",e)}),t.jsx(Y,{items:j,selected:r.data.labels,onChange:e=>a("labels",e),mt:"md"}),t.jsx(h,{label:"Time estimation",mt:"md",decimalScale:2,fixedDecimalScale:!0,defaultValue:0,min:0,allowNegative:!1,step:.5,suffix:" hours",onChange:e=>a("estimation",e)}),t.jsx(c,{label:"Pricing type",placeholder:"Select pricing type",required:!0,mt:"md",value:r.data.pricing_type,onChange:e=>a("pricing_type",e),data:C,error:r.errors.pricing_type}),y?t.jsx(h,{label:"Fixed price",mt:"md",decimalScale:2,fixedDecimalScale:!0,defaultValue:0,min:0,allowNegative:!1,prefix:D,onChange:e=>a("fixed_price",e),error:r.errors.fixed_price}):null,t.jsx(x,{label:"Billable",mt:"xl",checked:r.data.billable,onChange:e=>a("billable",e.currentTarget.checked)}),!R(g,["client"])&&t.jsx(x,{label:"Hidden from clients",mt:"md",checked:r.data.hidden_from_clients,onChange:e=>a("hidden_from_clients",e.currentTarget.checked)})]})]})})}export{Je as CreateTaskDrawer};
