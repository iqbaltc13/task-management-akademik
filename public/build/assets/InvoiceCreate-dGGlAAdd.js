import{f as F,d as $,e as H,j as e,U as ye,h as M,m as O,n as te,r as N,B as z,p as se,i as B,g as E,o as ie,s as je,q as ge,b as A,k as V,l as ve,G}from"./app-D4LeRcz-.js";import{A as be}from"./ActionButton-rmbJo8Uw.js";import{B as _e}from"./BackButton-DFLoXhEp.js";import{L as Ce}from"./Label-B4Jc12RG.js";import{u as we}from"./useForm-B7fipGN7.js";import{C as Z}from"./ContainerBox-BAILQIgC.js";import{m as ee}from"./currency-Ch0jvoq9.js";import{b as ke}from"./datetime-1UxvXaeE.js";import{a as Se,o as Re}from"./route-D3oki3go.js";import{B as Ie}from"./Breadcrumbs-CC_rLmIW.js";import{A as Te}from"./Anchor-CBiFzQ8k.js";import{G as L}from"./Grid-BkmoyeoR.js";import{T as oe}from"./Title-v-f79xZF.js";import{S as Ne}from"./SimpleGrid-ZtMkFqSk.js";import{T as ze}from"./TextInput-DRGNA9wl.js";import{S as Pe}from"./Select-BQGepa1f.js";import{M as Ae}from"./MultiSelect-qYHmzHib.js";import{g as ne}from"./get-auto-contrast-value-Da6zqqWm.js";import{I as Ge,a as Be,C as Ee}from"./Checkbox-CaaVdcyM.js";import{u as Fe}from"./DirectionProvider-BfCW8nl5.js";import{c as le}from"./create-optional-context-DIHD1p9X.js";import{I as ce}from"./Input-DgDk-0wJ.js";import{u as $e}from"./use-uncontrolled-D4udaf1u.js";import{N as re}from"./NumberInput-EWnAPIl4.js";import{T as De}from"./Textarea-BNXRMOxY.js";import{F as ae}from"./Flex-CdQtan9q.js";import{S as q}from"./Stack-BGDn0Wqx.js";import{T as R}from"./Text-CzrlvvXy.js";import{T as Ue}from"./Tooltip-D6COxl5A.js";import{C as Ve}from"./Center-CCRWs1KI.js";import{I as Le}from"./IconSearch-B41ebevp.js";import"./createReactComponent-DvqdhCGr.js";import"./ColorSwatch-CG_Yzh_s.js";import"./index-DsCOHdEJ.js";import"./_baseClone-BatMgSYk.js";import"./get-sorted-breakpoints-BPN_P9jc.js";import"./get-base-value-JqT_q0U7.js";import"./InputBase-UfetLwmU.js";import"./use-resolved-styles-api-ClQ3aNa8.js";import"./OptionsDropdown-CxPr4e2C.js";import"./CheckIcon-D7wk-t0p.js";import"./ScrollArea-BtKPsKY9.js";import"./Combobox-DnGWXCU-.js";import"./Popover-DklDwA2e.js";import"./use-floating-auto-update-CkIo9cus.js";import"./Pill-DFbPvVIq.js";import"./PillsInput-DfF2hQDi.js";import"./clamp-DTmYCdls.js";import"./get-style-object-DUJZA7T_.js";const[qe,de]=le(),[He,Me]=le();var me={card:"m_9dc8ae12"};const Oe={withBorder:!0},We=M((t,{radius:l})=>({card:{"--card-radius":O(l)}})),W=F((t,l)=>{const s=$("RadioCard",Oe,t),{classNames:c,className:h,style:m,styles:p,unstyled:i,vars:y,checked:_,mod:w,withBorder:r,value:C,onClick:d,name:v,onKeyDown:g,...o}=s,a=H({name:"RadioCard",classes:me,props:s,className:h,style:m,classNames:c,styles:p,unstyled:i,vars:y,varsResolver:We,rootSelector:"card"}),{dir:n}=Fe(),u=de(),k=typeof _=="boolean"?_:(u==null?void 0:u.value)===C||!1,S=v||(u==null?void 0:u.name),P=f=>{if(g==null||g(f),["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(f.nativeEvent.code)){f.preventDefault();const j=Array.from(document.querySelectorAll(`[role="radio"][name="${S||"__mantine"}"]`)),T=j.findIndex(D=>D===f.target),b=T+1>=j.length?0:T+1,x=T-1<0?j.length-1:T-1;f.nativeEvent.code==="ArrowDown"&&(j[b].focus(),j[b].click()),f.nativeEvent.code==="ArrowUp"&&(j[x].focus(),j[x].click()),f.nativeEvent.code==="ArrowLeft"&&(j[n==="ltr"?x:b].focus(),j[n==="ltr"?x:b].click()),f.nativeEvent.code==="ArrowRight"&&(j[n==="ltr"?b:x].focus(),j[n==="ltr"?b:x].click())}};return e.jsx(He,{value:{checked:k},children:e.jsx(ye,{ref:l,mod:[{"with-border":r,checked:k},w],...a("card"),...o,role:"radio","aria-checked":k,name:S,onClick:f=>{d==null||d(f),u==null||u.onChange(C||"")},onKeyDown:P})})});W.displayName="@mantine/core/RadioCard";W.classes=me;const Ke={},K=F((t,l)=>{const{value:s,defaultValue:c,onChange:h,size:m,wrapperProps:p,children:i,name:y,readOnly:_,...w}=$("RadioGroup",Ke,t),r=te(y),[C,d]=$e({value:s,defaultValue:c,finalValue:"",onChange:h}),v=g=>!_&&d(typeof g=="string"?g:g.currentTarget.value);return e.jsx(qe,{value:{value:C,onChange:v,size:m,name:r},children:e.jsx(ce.Wrapper,{size:m,ref:l,...p,...w,labelElement:"div",__staticSelector:"RadioGroup",children:e.jsx(Ge,{role:"radiogroup",children:i})})})});K.classes=ce.Wrapper.classes;K.displayName="@mantine/core/RadioGroup";function pe({size:t,style:l,...s}){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 5 5",style:{width:N(t),height:N(t),...l},"aria-hidden":!0,...s,children:e.jsx("circle",{cx:"2.5",cy:"2.5",r:"2.5",fill:"currentColor"})})}var ue={indicator:"m_717d7ff6",icon:"m_3e4da632","indicator--outline":"m_2980836c"};const Je={icon:pe},Qe=M((t,{radius:l,color:s,size:c,iconColor:h,variant:m,autoContrast:p})=>{const i=se({color:s||t.primaryColor,theme:t}),y=i.isThemeColor&&i.shade===void 0?`var(--mantine-color-${i.color}-outline)`:i.color;return{indicator:{"--radio-size":B(c,"radio-size"),"--radio-radius":l===void 0?void 0:O(l),"--radio-color":m==="outline"?y:E(s,t),"--radio-icon-size":B(c,"radio-icon-size"),"--radio-icon-color":h?E(h,t):ne(p,t)?ie({color:s,theme:t,autoContrast:p}):void 0}}}),J=F((t,l)=>{const s=$("RadioIndicator",Je,t),{classNames:c,className:h,style:m,styles:p,unstyled:i,vars:y,icon:_,radius:w,color:r,iconColor:C,autoContrast:d,checked:v,mod:g,variant:o,disabled:a,...n}=s,u=_,k=H({name:"RadioIndicator",classes:ue,props:s,className:h,style:m,classNames:c,styles:p,unstyled:i,vars:y,varsResolver:Qe,rootSelector:"indicator"}),S=Me(),P=typeof v=="boolean"?v:(S==null?void 0:S.checked)||!1;return e.jsx(z,{ref:l,...k("indicator",{variant:o}),variant:o,mod:[{checked:P,disabled:a},g],...n,children:e.jsx(u,{...k("icon")})})});J.displayName="@mantine/core/RadioIndicator";J.classes=ue;var he={root:"m_f3f1af94",inner:"m_89c4f5e4",icon:"m_f3ed6b2b",radio:"m_8a3dbb89","radio--outline":"m_1bfe9d39"};const Xe={labelPosition:"right"},Ye=M((t,{size:l,radius:s,color:c,iconColor:h,variant:m,autoContrast:p})=>{const i=se({color:c||t.primaryColor,theme:t}),y=i.isThemeColor&&i.shade===void 0?`var(--mantine-color-${i.color}-outline)`:i.color;return{root:{"--radio-size":B(l,"radio-size"),"--radio-radius":s===void 0?void 0:O(s),"--radio-color":m==="outline"?y:E(c,t),"--radio-icon-color":h?E(h,t):ne(p,t)?ie({color:c,theme:t,autoContrast:p}):void 0,"--radio-icon-size":B(l,"radio-icon-size")}}}),I=F((t,l)=>{const s=$("Radio",Xe,t),{classNames:c,className:h,style:m,styles:p,unstyled:i,vars:y,id:_,size:w,label:r,labelPosition:C,description:d,error:v,radius:g,color:o,variant:a,disabled:n,wrapperProps:u,icon:k=pe,rootRef:S,iconColor:P,onChange:f,mod:j,...T}=s,b=H({name:"Radio",classes:he,props:s,className:h,style:m,classNames:c,styles:p,unstyled:i,vars:y,varsResolver:Ye}),x=de(),D=(x==null?void 0:x.size)??w,fe=s.size?w:D,{styleProps:xe,rest:U}=je(T),Q=te(_),X=x?{checked:x.value===U.value,name:U.name??x.name,onChange:Y=>{x.onChange(Y),f==null||f(Y)}}:{};return e.jsx(Be,{...b("root"),__staticSelector:"Radio",__stylesApiProps:s,id:Q,size:fe,labelPosition:C,label:r,description:d,error:v,disabled:n,classNames:c,styles:p,unstyled:i,"data-checked":X.checked||void 0,variant:a,ref:S,mod:j,...xe,...u,children:e.jsxs(z,{...b("inner"),mod:{"label-position":C},children:[e.jsx(z,{...b("radio",{focusable:!0,variant:a}),onChange:f,...U,...X,component:"input",mod:{error:!!v},ref:l,id:Q,disabled:n,type:"radio"}),e.jsx(k,{...b("icon"),"aria-hidden":!0})]})})});I.classes=he;I.displayName="@mantine/core/Radio";I.Group=K;I.Card=W;I.Indicator=J;const Jo=()=>{const{projects:t,clientCompanies:l,nextNumber:s}=ge().props,[c,h]=A.useState([]),[m,p]=A.useState(""),[i,y]=A.useState([]),[_,w]=A.useState(0),[r,C,d]=we("post",route("invoices.store"),{number:s,client_company_id:"",projects:[],tasks:[],type:"hourly",hourly_rate:0,fixed_amount:0,note:""});V(()=>{h(t.filter(a=>a.client_company_id==r.data.client_company_id).map(a=>({value:a.id.toString(),label:a.name})));const o=l.find(a=>r.data.client_company_id===a.id.toString());o.rate&&d("hourly_rate",o.rate/100),p(o.currency)},[r.data.client_company_id]),V(()=>v(),[r.data.projects]),V(()=>{let o=0;r.data.type==="hourly"?i.forEach(a=>{a.tasks.forEach(n=>{r.data.tasks.includes(n.id)&&(o+=Number(n.total_minutes)/60*r.data.hourly_rate*100)})}):o=r.data.fixed_amount,w(o)},[r.data.tasks,r.data.type,r.data.hourly_rate,r.data.fixed_amount]);const v=()=>{r.data.projects.length&&ve.get(route("invoices.tasks",{projectIds:r.data.projects})).then(({data:o})=>{y(o.projectTasks);const a=[];o.projectTasks.forEach(n=>{n.tasks.forEach(u=>Number(u.total_minutes)>0&&a.push(u.id))}),d("tasks",[...a])}).catch(o=>console.error("Failed to fetch tasks",o))},g=(o,a)=>{d("tasks",a?[...r.data.tasks,o]:r.data.tasks.filter(n=>n!==o))};return e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{fz:14,mb:30,children:[e.jsx(Te,{href:"#",onClick:()=>Se("invoices.index"),fz:14,children:"Invoices"}),e.jsx("div",{children:"Create"})]}),e.jsxs(L,{justify:"space-between",align:"flex-end",gutter:"xl",mb:"lg",children:[e.jsx(L.Col,{span:"auto",children:e.jsx(oe,{order:1,children:"Create invoice"})}),e.jsx(L.Col,{span:"content"})]}),e.jsxs(Ne,{cols:2,spacing:"xl",children:[e.jsx(Z,{children:e.jsxs("form",{onSubmit:C,children:[e.jsx(ze,{label:"Invoice number",placeholder:"Invoice number",required:!0,value:r.data.number,onChange:o=>d("number",o.target.value),error:r.errors.number}),e.jsx(Pe,{label:"Client company",placeholder:"Select client company",searchable:!0,allowDeselect:!1,mt:"md",required:!0,value:r.data.client_company_id,onChange:o=>d("client_company_id",o),data:l.map(o=>({value:o.id.toString(),label:o.name})),error:r.errors.client_company_id}),e.jsx(Ae,{label:"Projects",placeholder:c.length?"Select projects":"Please select client company first",disabled:c.length===0,withAsterisk:!0,mt:"md",value:r.data.projects,onChange:o=>d("projects",o),data:c,error:r.errors.projects}),e.jsx(I.Group,{label:"Payment type",mt:"md",withAsterisk:!0,value:r.data.type,onChange:o=>d("type",o),children:e.jsxs(G,{mt:"xs",children:[e.jsx(I,{value:"hourly",label:"Hourly"}),e.jsx(I,{value:"fixed_amount",label:"Fixed amount"})]})}),r.data.type==="hourly"&&e.jsx(re,{label:"Hourly rate",mt:"md",allowNegative:!1,clampBehavior:"strict",decimalScale:2,fixedDecimalScale:!0,prefix:m.symbol,value:r.data.hourly_rate,onChange:o=>d("hourly_rate",o),error:r.errors.hourly_rate}),r.data.type==="fixed_amount"&&e.jsx(re,{label:"Fixed amount",mt:"md",allowNegative:!1,clampBehavior:"strict",decimalScale:2,fixedDecimalScale:!0,prefix:m.symbol,value:r.data.fixed_amount/100,onChange:o=>d("fixed_amount",o*100),error:r.errors.fixed_amount}),e.jsx(De,{label:"Note",placeholder:"Invoice note",mt:"md",autosize:!0,minRows:4,maxRows:8,value:r.data.note,onChange:o=>d("note",o.target.value)}),e.jsxs(G,{justify:"space-between",mt:"xl",children:[e.jsx(_e,{route:"invoices.index"}),e.jsx(be,{loading:r.processing,children:"Create"})]})]})}),e.jsx(Z,{children:i.length>0?e.jsxs(e.Fragment,{children:[i.map(o=>e.jsxs(z,{mb:"lg",children:[e.jsx(oe,{order:2,mb:"md",children:o.name}),o.tasks.length?o.tasks.map(a=>e.jsxs(ae,{justify:"space-between",wrap:"nowrap",children:[e.jsxs(G,{gap:"sm",wrap:"nowrap",align:"self-start",children:[e.jsx(Ee,{size:"sm",checked:r.data.tasks.includes(a.id),onChange:n=>g(a.id,n.currentTarget.checked)}),e.jsxs(q,{gap:3,children:[e.jsxs(R,{size:"sm",fw:500,onClick:()=>Re("projects.tasks.open",[a.project_id,a.id]),children:["#",a.number+": "+a.name]}),e.jsx(G,{wrap:"wrap",style:{rowGap:N(3),columnGap:N(12)},children:a.labels.map(n=>e.jsx(Ce,{name:n.name,color:n.color},n.id))})]})]}),e.jsxs(q,{gap:3,ml:10,style:{flexShrink:0},children:[r.data.type==="hourly"&&e.jsx(Ue,{label:Number(a.total_minutes)===0?"There is no logged time on this task":`Logged time: ${Number(a.total_minutes)/60}h`,openDelay:500,withArrow:!0,children:e.jsx(R,{fw:700,c:Number(a.total_minutes)===0?"red":"",children:ee(Number(a.total_minutes)/60*r.data.hourly_rate*100,m.code)})}),e.jsx(R,{size:"xs",c:"dimmed",fw:500,children:ke(a.completed_at)})]})]},a.id)):e.jsx(R,{size:"sm",c:"dimmed",children:"No tasks with logged time were found"})]},o.id)),e.jsx(ae,{justify:"flex-end",mt:"xl",children:e.jsxs(q,{gap:0,children:[e.jsx(R,{size:"lg",lts:1,fw:600,mb:-5,children:"Total:"}),e.jsx(R,{fw:700,fz:32,children:ee(_,m.code)})]})})]}):e.jsx(e.Fragment,{children:e.jsx(Ve,{mih:300,children:e.jsxs(z,{align:"center",children:[e.jsx(Le,{style:{width:N(55),height:N(55)},opacity:.5}),e.jsx(R,{fz:24,fw:600,align:"center",children:"No tasks found"}),e.jsx(R,{fz:15,c:"dimmed",children:"Select company and at least one project"})]})})})})]})]})};export{Jo as InvoiceCreate};
